!define(["api","fun"],function(e,n){return document.title="我的会员",function(t){"use strict";$(function(){function a(){this.getUserInfo=function(){e({},{type:"GET",url:"api/user_info"}).then(function(e){if(e&&0==e.status){var n=e.data;$('[data-name="headimg_url"]',t).css("background-image",'url("'+n.headimg_url+'")'),$('[data-name="nick_name"]',t).html(n.nick_name),$('[data-name="credit"]',t).html(n.credit);var a=$('[data-btn="signIn"]',t);a.data("disabled",!1),1==n.sign_in&&(a.html("已签到"),a.data("signIn",!0)),wx.config({debug:!1,appId:n.appId,timestamp:n.timestamp,nonceStr:n.nonceStr,signature:n.signature,jsApiList:["onMenuShareAppMessage","onMenuShareTimeline","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone","hideMenuItems"]}),wx.ready(function(){var e={title:"SG易乐充",desc:"SG易乐充,您的充值管家!",imgUrl:"/build/img/card.jpg",type:"link"};wx.onMenuShareAppMessage(e),wx.onMenuShareTimeline(e),wx.onMenuShareQQ(e),wx.onMenuShareWeibo(e),wx.onMenuShareQZone(e),wx.hideMenuItems({menuList:["menuItem:openWithQQBrowser","menuItem:openWithSafari","menuItem:copyUrl"]})})}})},this.getCreditRule=function(){e({},{type:"GET",url:"/api/text?text_name=credit_rule"}).then(function(e){if(e&&0==e.status){var a=n.formTips(e.data);$('[data-name="creditRule"]',t).html(a)}}),e({},{type:"GET",url:"/api/text?text_name=comsume_credit_rule"}).then(function(e){if(e&&0==e.status){var a=n.formTips(e.data);$('[data-name="comsumeCreditRule"]',t).html(a)}})}}t.on("click",".memberLi",function(e){var n=$(e.target);if(n.is("p"))return!1;if(n.is("span")&&(n=n.parent("li")),"link"===n.data("type"))return!1;var t=$(".memberLi-icon-slid",n);n.hasClass("opened")?(n.find(".memberLi-descWrap").hide(),n.removeClass("opened"),t.removeClass("opened").addClass("closed")):(n.find(".memberLi-descWrap").show(),n.addClass("opened"),t.removeClass("closed").addClass("opened")),n=null,t=null}).on("click",'[data-btn="signIn"]',function(n){var a=$(n.target);return 1!=a.data("disabled")&&("已签到"!==a.text()&&1!=a.data("signIn")&&void e({},{type:"GET",url:"api/sign_in"}).then(function(e){e&&0==e.status&&(a.html("已签到"),a.data("signIn",!0),$('[data-name="credit"]',t).html(e.data.credit))}))});var i=new a;i.getUserInfo(),i.getCreditRule()})}});