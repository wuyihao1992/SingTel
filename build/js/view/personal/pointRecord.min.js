!define(["conf","api","fun"],function(t,n,e){"use strict";return document.title="积分记录",function(t){$(function(){var a=function(){var a=$("#app"),i=$("#pointRecord",t),o=$("#loadMore",t),l=o.outerHeight(!0),r=this;this.bizCont={page:1},this.canLoadPage=!0,this.fetchData=function(){r.canLoadPage=!1,n(r.bizCont,{type:"GET",url:"api/user_credit_log"}).then(function(t){if(t&&0==t.status){var n=t.data;if(n.length>0){r.canLoadPage=!0,r.bizCont.page+=1;var l=r.renderList(n);i.append(l),l=null,e.isShowLoading(a,o)}else r.canLoadPage=!1,o.show(),1===r.bizCont.page?o.html("您暂时没有积分记录。"):o.html("没有更多数据")}else r.canLoadPage=!0,o.show(),o.html("没有更多数据")},function(){r.canLoadPage=!0,o.show(),o.html("请求数据失败")})},this.renderList=function(t){var n="";for(var e in t){var a=t[e],i="";""!==a.value&&(i=a.value.toString().indexOf("-")>-1?"r-colorBlue":"r-colorRed");var o='<div class="record__point '+i+'">'+a.value+"</div>";n+='<li><p class="record__tit">'+a.credit_type+'</p><p class="record__time">'+a.time+"</p>"+o+"</li>",a=null,i=null,o=null}return n},this.init=function(){a.on("scroll",function(){if(r.canLoadPage===!1)return!1;var t=a.get(0),n=t.scrollHeight,e=t.clientHeight,i=t.scrollTop;n-=l,i+e>=n&&r.fetchData(),t=null,n=null,e=null,i=null}),r.fetchData()}},i=new a;i.init()})}});