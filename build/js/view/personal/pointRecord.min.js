!define(["conf","api","fun"],function(t,e,n){"use strict";return document.title="积分记录",function(t){$(function(){var a=function(){var a=$("#app"),i=$("#pointRecord",t),l=$("#loadMore",t),o=l.outerHeight(!0),r=this;this.bizCont={page:1},this.canLoadPage=!0,this.fetchData=function(){r.canLoadPage=!1,e(r.bizCont,{type:"GET",url:"api/user_credit_log"}).then(function(t){if(t&&0==t.status){var e=t.data;if(e.length>0){r.canLoadPage=!0,r.bizCont.page+=1;var o=r.renderList(e);i.append(o),o=null,n.isShowLoading(a,l)}else r.canLoadPage=!1,l.show(),1===r.bizCont.page?l.html("您暂时没有积分记录。"):l.html("没有更多数据")}else r.canLoadPage=!0,l.show(),l.html("没有更多数据")},function(){r.canLoadPage=!0,l.show(),l.html("请求数据失败")})},this.renderList=function(t){var e="";for(var n in t){var a=t[n],i="";""!==a.value&&(a.value=a.value.toString(),a.value.indexOf("-")>-1?i="r-colorBlue":(i="r-colorRed",a.value.indexOf("+")<0&&(a.value="+"+a.value)));var l='<div class="record__point '+i+'">'+a.value+"</div>";e+='<li><p class="record__tit">'+a.credit_type+'</p><p class="record__time">'+a.time+"</p>"+l+"</li>",a=null,i=null,l=null}return e},this.init=function(){a.on("scroll",function(){if(r.canLoadPage===!1)return!1;var t=a.get(0),e=t.scrollHeight,n=t.clientHeight,i=t.scrollTop;e-=o,i+n>=e&&r.fetchData(),t=null,e=null,n=null,i=null}),r.fetchData()}},i=new a;i.init()})}});