!define(["api","fun","conf","qrcode"],function(e,t,n,i){return document.title="SG易乐充",function(i){"use strict";$(function(){function o(e){var t=new Image;return t.src=e.toDataURL("image/png"),t}var a=n.dev?"/test":"",r="",s="正在获取积分规则，请稍后！",c=function(){this.testQRCode=function(e){var t=$("#shareQRCodes",i);if(e)$("#qrcodeImg",t).append('<img class="qrCodeImg" id="QRCode" src="'+a+'/build/img/QRCode.jpg" />');else{$("#qrDiv",t).qrcode({render:"canvas",width:t.height(),height:t.height(),text:"https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket="});var n=document.getElementsByTagName("canvas")[0],r=o(n);$("#qrcodeImg",t).append(r)}},this.getQRCode=function(){var t=$("#shareQRCodes",i);e({},{type:"GET",url:"api/qrcode"}).then(function(e){if(e&&0==e.status){$("#qrDiv",t).qrcode({render:"canvas",width:t.height(),height:t.height(),text:"https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket="+e.data.ticket});var n=document.getElementsByTagName("canvas")[0],i=o(n);$("#qrcodeImg",t).append(i)}else $("#qrcodeImg",t).append('<img class="qrCodeImg" id="QRCode" src="'+a+'/build/img/QRCode.jpg" />')})},this.getQRCodeImg=function(){var t=$("#shareQRCodes",i);e({},{type:"GET",url:"api/qrcode"}).then(function(e){if(e&&0==e.status){var n="https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket="+e.data.ticket;$("#qrcodeImg",t).append('<img class="qrCodeImg" id="QRCode" src="'+n+'" />')}else $("#qrcodeImg",t).append('<img class="qrCodeImg" id="QRCode" src="'+a+'/build/img/QRCode.jpg" />')})},this.getCredit=function(){e({},{type:"GET",url:"api/text?text_name=credit_rule"}).then(function(e){e&&0==e.status?r=t.formTips(e.data):s="暂无积分规则"})},this.weChatShare=function(){e({url:location.href},{type:"GET",url:"api/user_info"}).then(function(n){if(n&&0==n.status){var i=n.data;wx.config({debug:!0,appId:i.app_id,timestamp:i.timestamp,nonceStr:i.noncestr,signature:i.sign,jsApiList:["onMenuShareAppMessage","onMenuShareTimeline","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone","hideMenuItems"],success:function(n){e({},{type:"GET",url:"api/share"}).then(function(e){e&&0==e.status&&t.swal("分享成功","success")})}}),wx.error(function(e){t.swal("微信签名失败","error")}),wx.ready(function(){var e={title:"SG易乐充",desc:"SG易乐充,您的充值管家!",link:location.origin+location.pathname+"#/common/share",imgUrl:a+"/build/img/card.jpg",type:"link"};wx.onMenuShareAppMessage(e),wx.onMenuShareTimeline(e),wx.onMenuShareQQ(e),wx.onMenuShareWeibo(e),wx.onMenuShareQZone(e),wx.hideMenuItems({menuList:["menuItem:openWithQQBrowser","menuItem:openWithSafari","menuItem:copyUrl"]})})}})},this.init=function(){this.getQRCodeImg(),this.getCredit(),this.weChatShare()}},d=new c;d.init(),$("#showDetail",i).on("click",function(e){return r?void layer.open({title:!1,btn:!1,area:["88%","88%"],anim:4,scrollbar:!1,content:r}):(t.swal(s,"info"),!1)})})}});